---
import { getFramework, type Framework } from '@/lib/framework'
// This had to be external or it somehow messed with Astro's type inference:
import type { SingleTrueKey } from '@/lib/types'
import type { HTMLTag, Polymorphic } from 'astro/types'

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> &
	(
		| {
				[framework in Framework]?: string
		  }
		| SingleTrueKey<Framework>
	)

const { as: _Tag, react, vue, svelte, vanilla, ...props } = Astro.props
let Tag = _Tag ?? (Object.keys(props).length ? 'div' : Fragment)
const framework = getFramework(Astro.params)
---

<Tag {...props}
	>{
		/*
	We can't use a loop here because Astro needs the slot names to be static strings
	*/
	}{
		framework === 'react' &&
			(typeof react == 'string' ? (
				react
			) : Astro.slots.has('react') ? (
				<slot name="react" />
			) : (
				<slot />
			))
	}{
		framework === 'vue' &&
			(typeof vue == 'string' ? vue : Astro.slots.has('vue') ? <slot name="vue" /> : <slot />)
	}{
		/*
		 */
	}</Tag
>
